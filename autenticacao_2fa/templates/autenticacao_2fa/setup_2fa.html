{% extends "base.html" %}
{% load static %}

{% block title %}Configurar Autentica√ß√£o de Dois Fatores - ARES{% endblock %}

{% block body_class %}twofa-page{% endblock %}

{% block content %}
<div class="setup-2fa-container">
    <div class="setup-2fa-header">
        <h1>üîê Configurar Autentica√ß√£o de Dois Fatores</h1>
        <p>Aumente a seguran√ßa da sua conta com verifica√ß√£o em duas etapas</p>
    </div>
    
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <div class="instructions">
        <h3>üì± Instru√ß√µes de Configura√ß√£o</h3>
        <ol>
            <li>
                <strong>Instale um app autenticador</strong> no seu celular:
                <ul>
                    <li>Google Authenticator (Android/iOS)</li>
                    <li>Microsoft Authenticator (Android/iOS)</li>
                    <li>Authy (Android/iOS/Desktop)</li>
                </ul>
            </li>
            <li><strong>Escaneie o QR code</strong> abaixo com o app</li>
            <li>Ou <strong>insira a chave manualmente</strong> se o QR code n√£o funcionar</li>
            <li><strong>Digite o c√≥digo de 6 d√≠gitos</strong> gerado pelo app</li>
        </ol>
    </div>
    
    <div class="qr-code-section">
        <h3>Escaneie este QR Code</h3>
        <img src="data:image/png;base64,{{ qr_code }}" alt="QR Code para 2FA">
    </div>
    
    <div class="secret-key-section">
        <h3>‚ö†Ô∏è Chave Secreta (Backup)</h3>
        <p>Guarde esta chave em local seguro. Voc√™ pode us√°-la para configurar o autenticador manualmente:</p>
        <div class="secret-key-code">{{ secret_key }}</div>
    </div>
    
    <form method="post" class="verification-form">
        {% csrf_token %}
        <h3>Verificar C√≥digo</h3>
        <p>Digite o c√≥digo de 6 d√≠gitos gerado pelo seu app autenticador:</p>
        
        <div class="form-group">
            <label for="token">C√≥digo de Verifica√ß√£o:</label>
            <input 
                type="text" 
                id="token" 
                name="token" 
                maxlength="6" 
                pattern="[0-9]{6}" 
                placeholder="000000"
                data-auto-submit="false"
                required
                autofocus
            >
        </div>
        
        <button type="submit" class="btn-activate">‚úì Verificar e Ativar 2FA</button>
        <a href="{% url 'dashboard:index' %}" class="btn-cancel">Cancelar</a>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/twofa-input.js' %}"></script>
{% endblock %}
